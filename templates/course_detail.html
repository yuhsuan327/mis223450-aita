<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>
    {% if course %}{{ course.name }} - èª²ç¨‹è©³æƒ…{% else %}èª²ç¨‹è©³æƒ…{% endif %}
  </title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

{% include 'navbar.html' %}



<!-- âœ… ä¸»é«”å€å¡Š -->
<div class="container mt-5">
  {% if course %}
    <div class="card p-4 shadow">
      <h3 class="mb-3 text-primary">{{ course.name }}</h3>
      <p class="text-muted mb-1">ğŸ—“ æ—¥æœŸï¼š{{ course.date }}</p>
      <p class="mb-4">ğŸ“– {{ course.description|default:"ï¼ˆæ­¤èª²ç¨‹å°šç„¡ç°¡ä»‹ï¼‰" }}</p>

      <!-- âœ… ä¸Šå‚³éŸ³æª” -->
      <h5 class="text-success mb-3">ğŸ¤ ä¸Šå‚³å–®å…ƒéŸ³æª”ä¸¦ç”¢ç”Ÿæ‘˜è¦åŠæ¸¬é©—è€ƒé¡Œ</h5>
      <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="mb-3">
        <label for="lecture_title" class="form-label">å–®å…ƒåç¨±ï¼š</label>
        <input type="text" name="lecture_title" id="lecture_title" class="form-control" required>
      </div>
        <div class="mb-3">
          <label for="id_audio_file" class="form-label">é¸æ“‡éŸ³æª”ï¼š</label>
          <input type="file" name="audio_file" id="id_audio_file" class="form-control" required>
        </div>

        <!-- ğŸ¯ é¡Œå‹é¸æ“‡å€å¡Šï¼ˆæ–°å¢åœ¨ lecture_title ä¸‹æ–¹ï¼‰ -->
        <div class="row mb-3">
          <div class="col-6 pe-1">
            <label for="num_mcq" class="form-label">é¸æ“‡é¡Œæ•¸é‡</label>
            <input type="number" name="num_mcq" id="num_mcq" class="form-control" value="5" min="0">
          </div>
           <div class="col-6 ps-1">
            <label for="num_tf" class="form-label">æ˜¯éé¡Œæ•¸é‡</label>
            <input type="number" name="num_tf" id="num_tf" class="form-control" value="0"  min="0">
          </div>
        </div>

        <button type="submit" class="btn btn-primary w-100">ç”¢ç”Ÿæ‘˜è¦åŠæ¸¬é©—è€ƒé¡Œ</button>
      </form>
    </div>

     <!-- ğŸŸ¦ ç›´æ¥éŒ„éŸ³å¡ç‰‡ -->
  <!-- ğŸ™ï¸ ç›´æ¥éŒ„éŸ³å¡ç‰‡ -->
<div class="card p-4 shadow mt-4">
  <h5 class="text-danger">ğŸ™ï¸ ç›´æ¥éŒ„éŸ³ç”¢ç”Ÿè€ƒé¡Œ</h5>
  
  <div class="mb-2">
    <label for="lecture_title_record" class="form-label">å–®å…ƒåç¨±ï¼š</label>
    <input type="text" id="lecture_title_record" class="form-control" placeholder="è«‹è¼¸å…¥å–®å…ƒåç¨±">
  </div>

  <div class="row mb-3">
    <div class="col-md-6">
      <label for="num_mcq_record" class="form-label">é¸æ“‡é¡Œæ•¸é‡</label>
      <input type="number" id="num_mcq_record" class="form-control" value="3" min="0">
    </div>
    <div class="col-md-6">
      <label for="num_tf_record" class="form-label">æ˜¯éé¡Œæ•¸é‡</label>
      <input type="number" id="num_tf_record" class="form-control" value="2" min="0">
    </div>
  </div>

  <div class="d-flex gap-2">
    <button id="startRecord" class="btn btn-danger">ğŸ”´ é–‹å§‹éŒ„éŸ³</button>
    <button id="stopRecord" class="btn btn-secondary" disabled>â¹ åœæ­¢éŒ„éŸ³</button>
  </div>
</div>

<script>
let mediaRecorder;
let audioChunks = [];

document.getElementById("startRecord").onclick = async () => {
  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  mediaRecorder = new MediaRecorder(stream);
  audioChunks = [];

  mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
  mediaRecorder.onstop = async () => {
    const blob = new Blob(audioChunks, { type: 'audio/webm' });
    const formData = new FormData();
    formData.append('audio_data', blob, 'recorded.webm');
    formData.append('lecture_title', document.getElementById('lecture_title_record').value);
    formData.append('num_mcq', document.getElementById('num_mcq_record').value);
    formData.append('num_tf', document.getElementById('num_tf_record').value);

    const courseId = "{{ course.id }}";
    await fetch(`/course/${courseId}/record/`, {
        method: 'POST',
          body: formData
          });

          window.location.reload();
          };

  mediaRecorder.start();
  document.getElementById("startRecord").disabled = true;
  document.getElementById("stopRecord").disabled = false;
};

document.getElementById("stopRecord").onclick = () => {
  mediaRecorder.stop();
  document.getElementById("stopRecord").disabled = true;
};
</script>

    <!-- âœ… æ‰€æœ‰è¬›æ¬¡åˆ—è¡¨ -->
    <div class="card mt-4 p-4 shadow">
      <h5 class="mb-3 text-primary">ğŸ“š å·²ä¸Šå‚³å–®å…ƒ</h5>
      {% if lectures %}
        <ul class="list-group">
          {% for lec in lectures %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <strong>å–®å…ƒ #{{ lec.id }}</strong> - {{ lec.date|date:"Y-m-d" }}<br>
                {{ lec.summary|truncatechars:40|default:"(å°šç„¡æ‘˜è¦)" }}
              </div>
              <div class="d-flex justify-content-end gap-2">
              <a href="{% url 'lecture_detail' lec.id %}" class="btn btn-outline-primary btn-sm">æŸ¥çœ‹æ‘˜è¦</a>
              <a href="{% url 'edit_lecture_title' lec.id %}" class="btn btn-outline-info btn-sm">æ›´æ”¹å–®å…ƒåç¨±</a>
            </div>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="text-muted">å°šæœªä¸Šå‚³ä»»ä½•å–®å…ƒã€‚</p>
      {% endif %}
    </div>
  {% else %}
    <div class="alert alert-warning shadow text-center p-4">
      <h4 class="mb-3">âš  å°šæœªæŒ‡å®šèª²ç¨‹</h4>
      <p>è«‹å¾èª²ç¨‹ç¸½è¦½ä¸­é¸æ“‡ä¸€é–€èª²ç¨‹ä¾†æŸ¥çœ‹å–®å…ƒèˆ‡æ“ä½œåŠŸèƒ½ã€‚</p>
      <a href="{% url 'lecture_list' %}" class="btn btn-outline-primary">è¿”å›èª²ç¨‹ç¸½è¦½</a>
    </div>
  {% endif %}
</div>

</body>
</html>
